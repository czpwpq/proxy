<!doctypehtml>
<html>
<head>
<title>Web Proxy</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
<base target=_blank>
<style>body{padding:0 .5em}.box{margin-top:1em}#txtURL{width:100%;height:2em;text-indent:.5em;padding:.25em 0}#btnGo{width:100%;font-size:1.5em}#list a{margin:1em}</style>
</head>
<body>
<div class=box><input id=txtURL value=www.google.com autofocus></div>
<div class=box><button id=btnGo disabled=disabled>初始化中...</button></div>
<div class=box><span>切换线路:</span> <select id=selNode disabled=disabled></select></div>
<div class=box id=list></div>
<script>var c=100,a=103,r=200,s=navigator.serviceWorker;function l(){return location.pathname.replace(/\w+\.\w+$/,"").replace(/\/*$/,"/")}function t(){setTimeout(i,100),selNode.disabled=!1,s.addEventListener("message",e)}function e(e){var t=e.data,o=t[0],n=t[1];switch(o){case a:!function i(e){if(e){var t="*[value="+e+"]";selNode.querySelector(t).selected=!0}}(n);break;case r:u(c)}}function o(e){txtURL.value=e}function u(e,t){var o=s.controller;o?o.postMessage([e,t]):console.log("ctl is null")}btnGo.onclick=function(){var e=txtURL.value.trim();0<=e.indexOf("-----")&&(e=e.split("-----").pop(),txtURL.value=e);var t=function o(e){return l()+"-----"+e}(function n(e){return/^https?:\/\//i.test(e)?e:/\.(com|cn|net|org|tv)$/.test(e)?"https://"+e:"https://www.google.com/search?q="+encodeURIComponent(e)}(e));open(t).opener=null},txtURL.onkeypress=function(e){13===e.keyCode&&btnGo.onclick()},txtURL.setSelectionRange(0,txtURL.value.length),selNode.onchange=function(){u(102,this.options[this.selectedIndex].value)};var n=[["google",""],["youtube",""],["twitter","twitter.com/google"],["flickr",""],["quora","www.quora.com/topic/JavaScript-programming-language"],["twitch","www.twitch.tv"],["reddit",""],["wiki","zh.wikipedia.org"],["gist","gist.github.com"],["facebook","facebook.com/Google/"],["blogger",""]];function i(){list.innerHTML=n.map(function(e){var t=e[0];return"<a rel=noopener href=./-----https://"+(e[1]||"www."+t+".com")+"><img width=128 height=128 src=assets/ico/"+t+".png></a>"}).join("")}self.jsproxy_config=function(n){!function e(){s.getRegistration().then(function(e){e?(t(),u(c)):s.register(l()+"sw.js").then(t)["catch"](o)})}();var i=n.node_map;Object.keys(i).forEach(function(e){var t=i[e];if(!t.hidden){var o=document.createElement("option");o.text=t.label,(o.value=e)===n.node_default&&(o.selected=!0),selNode.appendChild(o)}})},function g(){console.log("JsProxy v0.0.9 https://github.com/EtherDream/jsproxy/"),self.isSecureContext?s&&self.ReadableStream?(btnGo.disabled=!1,btnGo.textContent="Go"):txtURL.value="浏览器版本过低，推荐使用最新版 Chrome 浏览器":txtURL.value="本程序需要 HTTPS 站点"}()</script>
<script src=conf.js></script>
</body>
</html>
